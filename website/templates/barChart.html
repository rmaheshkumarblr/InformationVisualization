{% extends "base.html" %}


{% block head %}
    {{ super() }}
    <script src="{{url_for('.static', filename='js/jquery-1.12.4.js')}}" charset="utf-8"></script>
    <script src="{{url_for('.static', filename='js/jquery-ui.js')}}" charset="utf-8"></script>
    <script src="{{url_for('.static', filename='js/d3.v4.min.js')}}" charset="utf-8"></script>
{% endblock %}
{% block styles %}
{{super()}}
<link rel="stylesheet" href="{{url_for('.static', filename='css/jquery-ui.css')}}">
{% endblock %}


{% block page_content %}


<h1>Number of Survivors Vs Flight Type</h1>

<p>
  <label for="amount">No of Survivors Range: </label>
  <input type="text" id="amount" readonly style="border:0; color:#f6931f; font-weight:bold;">
</p>
 
<div id="slider-range"></div>

<script>
minValue = 1
maxValue = 12000
overallData = ""
$(
  function() 
  {
    $("#slider-range").slider({
      range: true,
      min: 1,
      max: 12000,
      values: [ 1, 12000 ],
      slide: function( event, ui ) 
      {
        minValue = ui.values[ 0 ];
        maxValue = ui.values[ 1 ];
        $( "#amount" ).val( "" + ui.values[ 0 ] + " - " + ui.values[ 1 ] );
        barChartWithMinMaxValue(overallData,minValue,maxValue)
        // console.log('Min Value: ' + minValue + ", MaxValue: " + maxValue);
      }
    });
    
    $("#amount" ).val( "" + $( "#slider-range" ).slider( "values", 0 ) +
      " - " + $( "#slider-range" ).slider( "values", 1 ) );

    
  } 
);

// set the dimensions and margins of the graph
var margin = {top: 20, right: 20, bottom: 70, left: 40},
    width = 1150 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

// set the ranges
var x = d3.scaleBand()
          .range([0, width])
          .padding(0.1);
var y = d3.scaleLinear()
          .range([height, 0]);
          
// append the svg object to the body of the page
// append a 'group' element to 'svg'
// moves the 'group' element to the top left margin
var svg = d3.select("body").select("#graph").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");


barChartWithDefaultValue(minValue,maxValue)  


function barChartWithDefaultValue(minValue,maxValue)
{
  
  // get the data
  d3.json("/survivorsVsFlightType", function(error, data) {
    overallData = data;
    if (error) throw error;
  
    // format the data
    data.forEach(function(d) {
      //console.log(d.noOfSurvivors)
      d.noOfSurvivors = +d.noOfSurvivors;
    });
  
    // Scale the range of the data in the domains
    x.domain(data.map(function(d) 
      { 
        if( d.noOfSurvivors >= minValue &&  d.noOfSurvivors < maxValue )
        {
          return d.TypeOfFlight; 
        }
      }
    ));
    y.domain([0, d3.max(data, function(d)
      { 
        if( d.noOfSurvivors >= minValue &&  d.noOfSurvivors < maxValue )
        {
          //console.log(d.noOfSurvivors)
          return d.noOfSurvivors; 
        }  
      }
    )]);
  
    // append the rectangles for the bar chart
    svg.selectAll(".bar")
        .data(data)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("x", function(d) 
          { 
            if( d.noOfSurvivors >= minValue &&  d.noOfSurvivors < maxValue )
            {
              return x(d.TypeOfFlight); 
            }
          })
        .attr("width", x.bandwidth())
        .attr("y", function(d) 
          { 
            if( d.noOfSurvivors >= minValue &&  d.noOfSurvivors < maxValue )
            {
              return y(d.noOfSurvivors); 
            }
          })
        .attr("height", function(d) 
          { 
            if( d.noOfSurvivors >= minValue &&  d.noOfSurvivors < maxValue )
            {
              return height - y(d.noOfSurvivors); 
            }
          });
  
    // add the x Axis
    svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .attr("class", "x axis")
        .call(d3.axisBottom(x))
        .selectAll("text")  
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", ".15em")
            .attr("transform", function(d) {
                return "rotate(-65)" 
                });
  
    // add the y Axis
    svg.append("g")
        .attr("class", "y axis")
        .call(d3.axisLeft(y));
  
  });
}


function barChartWithMinMaxValue(overallData,minValue,maxValue)
{
  // console.log(overallData)
  data = overallData;
  
  // get the data
  (function() {
    // if (error) throw error;
  
    // format the data
    data.forEach(function(d) {
      //console.log(d.noOfSurvivors)
      d.noOfSurvivors = +d.noOfSurvivors;
    });
  
    // Scale the range of the data in the domains
    x.domain(data.map(function(d) 
      { 
        if( d.noOfSurvivors >= minValue &&  d.noOfSurvivors < maxValue )
        {
          return d.TypeOfFlight; 
        }
      }
    ));
    y.domain([0, d3.max(data, function(d)
      { 
        if( d.noOfSurvivors >= minValue &&  d.noOfSurvivors < maxValue )
        {
          //console.log(d.noOfSurvivors)
          return d.noOfSurvivors; 
        }  
      }
    )]);

    console.log(x)
    svg.select('.x.axis').transition().duration(0).call(d3.axisBottom(x)).selectAll("text")  
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", ".15em")
            .attr("transform", function(d) {
                return "rotate(-65)" 
                });
    svg.select('.y.axis').transition().duration(0).call(d3.axisLeft(y));

    var bars = svg.selectAll(".bar").data(data, function(d) {
      if( d.noOfSurvivors >= minValue &&  d.noOfSurvivors < maxValue )
      {
        return x(d.TypeOfFlight); 
      }
    })

if (!isNaN(y(0)))
{
  yValue = y(0)
}
else
{
  yValue = 0
}
    bars.exit()
    .transition()
    .duration(0)
    .attr("y", yValue)
    .attr("height", height - yValue)
    .style('fill-opacity', 1e-6)
    .remove();


if (!isNaN(y(0)))
{
  // data that needs DOM = enter() (a set/selection, not an event!)
    bars.enter().append("rect")
    .attr("class", "bar")
    .attr("y", y(0))
    .attr("height", height - y(0));

    // console.log(bars)
    // the "UPDATE" set:
    bars.transition().duration(0).attr("x", function(d) 
    { 
      if( d.noOfSurvivors >= minValue &&  d.noOfSurvivors < maxValue )
      {
        return x(d.TypeOfFlight); 
      }
    }) // (d) is one item from the data array, x is the scale object from above
    .attr("width", x.bandwidth()) // constant, so no callback function(d) here
    .attr("y", function(d) 
    { 
      if( d.noOfSurvivors >= minValue &&  d.noOfSurvivors < maxValue )
      {
        return y(d.noOfSurvivors); 
      }
    })
    .attr("height", function(d) 
    { 
      if( d.noOfSurvivors >= minValue &&  d.noOfSurvivors < maxValue )
      {
        return height - y(d.noOfSurvivors); 
      }
    }); // flip the height, because y's domain is bottom up, but SVG renders top down
}
    
  })();
}




</script>

{% endblock %}